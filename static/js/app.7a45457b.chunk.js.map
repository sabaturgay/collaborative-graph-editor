{"version":3,"sources":["api/firebase.ts","components/MouseArrow.tsx","components/GraphEditor.tsx","components/GetNameDialog.tsx","App.tsx"],"names":["app","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","firestore","getAnalytics","getFirestore","auth","getAuth","PATHS","deleteEdge","variables","a","async","id","ref","doc","deleteDoc","err","console","log","updateUser","user","setDoc","deleteUser","MouseArrow","position","label","localDataRef","React","useRef","targetPosition","containerRef","color","useMemo","randomColor","Math","floor","random","toString","Color","rgbNumber","draw","useCallback","g","drawArrowHead","graphics","fill","to","x","y","unitVector","current","useEffect","tickerFunc","container","Vector","fromObject","currentPosition","distance","clone","subtract","length","normalize","newPosition","add","multiplyScalar","PIXI","shared","remove","Graphics","Text","text","radius","bottomCenter","unitDistanceVec","perpendicularUnitDistanceVec","rotate","PI","leftControlPoint","rightControlPoint","topControlPoint","beginFill","drawPolygon","endFill","PROJECT_ID","MyGraphEditor","props","width","height","userName","useImmer","users","state","updateState","userId","R","mousePosition","userInitialized","useController","nodes","edges","dataBar","editable","networkStatistics","local","global","onEvent","draft","type","payload","elementId","graphEditor","graphRef","cy","update","element","context","$id","getSelectedItemByElement","item","index","EVENT","UPDATE_DATA","value","getSelectedElementInfo","selectedItem","updateDoc","data","API","ADD_NODE","items","edgeItems","forEach","name","mode","EDITOR_MODE","ADD","DEFAULT","DELETE_NODE","itemIds","edgeItem","includes","source","target","DELETE","ADD_EDGE","DELETE_EDGE","controllerProps","controller","graphEditorRef","removeUser","createUser","config","useSubscription","collection","onSnapshot","querySnapshot","docChanges","change","elementType","event","targetList","push","filter","handleWindowChange","e","document","visibilityState","focusHandler","blurHandler","visibilityChangeHandler","beforeUnloadHandler","window","addEventListener","isTrackRef","interval","setInterval","debounced","getPointerPositionOnViewport","viewport","onMouseMove","clearInterval","removeEventListener","GraphEditor","style","map","GetNameDialog","onSubmit","useState","setName","Dialog","open","DialogTitle","DialogContent","TextField","autoFocus","margin","fullWidth","variant","onChange","onKeyPress","key","DialogActions","Button","onClick","App","useLayout","onLayout","isLoading","signin","signInWithPopup","GoogleAuthProvider","result","alert","Promise","res","rej","onAuthStateChanged","error","call","useAuth","ActivityIndicator","View","styles","StyleSheet","create","flex","backgroundColor","alignItems","justifyContent"],"mappings":"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","file":"static/js/app.7a45457b.chunk.js","sourcesContent":["import React from 'react'\n// Import the functions you need from the SDKs you need\nimport { initializeApp } from \"firebase/app\";\nimport { getAnalytics } from \"firebase/analytics\";\nimport { \n  getFirestore,addDoc, updateDoc, doc,\n  onSnapshot, collection,  deleteDoc, setDoc,\n } from \"firebase/firestore\";\n import { getAuth, signInWithPopup, GoogleAuthProvider } from \"firebase/auth\";\nimport { useSubscription,   } from 'colay-ui'\nimport { useImmer,   } from 'colay-ui/hooks/useImmer'\nimport * as R from 'colay/ramda'\n// TODO: Add SDKs for Firebase products that you want to use\n// https://firebase.google.com/docs/web/setup#available-libraries\n\n\n// Your web app's Firebase configuration\n// For Firebase JS SDK v7.20.0 and later, measurementId is optional\nconst firebaseConfig = {\n  apiKey: \"AIzaSyB8I11ntIAhLCoz2iw2cWVZl6NoWQ44yR0\",\n  authDomain: \"perfectgraph-5c619.firebaseapp.com\",\n  databaseURL: \"https://perfectgraph-5c619.firebaseio.com\",\n  projectId: \"perfectgraph-5c619\",\n  storageBucket: \"perfectgraph-5c619.appspot.com\",\n  messagingSenderId: \"214633043236\",\n  appId: \"1:214633043236:web:fa42d761199303b786cfb1\",\n  measurementId: \"G-GYX9R6E88Y\"\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst analytics = getAnalytics(app);\nconst firestore = getFirestore(app);\nconst auth = getAuth(app);\n\nconst PATHS = {\n  projects: 'projects',\n  nodes: 'nodes',\n  edges: 'edges',\n  users: 'users',\n}\n\nexport const useAuth = () => {\n  const [state, updateState] = useImmer({\n    user: null,\n    isLoading: true,\n    signin: async () => {\n      try {\n        updateState(draft => {\n          draft.isLoading = true\n        })\n        const result = await signInWithPopup(auth, new GoogleAuthProvider())\n        // const credential = GoogleAuthProvider.credentialFromResult(result);\n        // const token = credential.accessToken;\n        console.log('AA', result)\n        const user = result.user;\n        updateState(draft => {\n          draft.isLoading = false\n          draft.user = user\n        })\n      } catch (error) {\n        alert('There is an error with your login! Refresh the page and try again!')\n        console.log('error', error)\n        // const errorCode = error.code;\n        //   const errorMessage = error.message;\n        //   // The email of the user's account used.\n        //   const email = error.email;\n        //   // The AuthCredential type that was used.\n        //   const credential = GoogleAuthProvider.credentialFromError(error);\n      }\n    }\n  })\n  React.useEffect(() => {\n    const call = async () => {\n      const user = await new Promise((res, rej) => {\n        auth.onAuthStateChanged((user, error) => {\n          res(user)\n        })\n      })\n      updateState((draft) => {\n        draft.isLoading = false\n        draft.user = user \n      })\n    }\n    call()\n  }, [])\n  return state\n}\n\ntype Event = {\n  type: string;\n  elementType: 'nodes' | 'edges' | 'users';\n  data: any\n}\ntype SubscriptionConfig = {\n  projectId: string;\n  onEvent: (event: Event) => void;\n}\n\nexport const useProjectSubscription = (config: SubscriptionConfig) => { \n  const {\n     onEvent,\n     projectId,\n  } = config\n  // useSubscription(() => {\n  //   const ref = doc(firestore, `${PATHS.projects}/${projectId}`)\n  //     onSnapshot(ref,querySnapshot => {\n  //       const data = querySnapshot.data()\n\n  //     });\n  // })\n  // NODES\n  useSubscription(() => {\n    const ref = collection(firestore, `${PATHS.projects}/${projectId}/${PATHS.nodes}`)\n    onSnapshot(ref,querySnapshot => {\n      querySnapshot.docChanges().forEach(change => {\n        const data = change.doc.data()\n        onEvent({\n          elementType: 'nodes',\n          data,\n          type: change.type,\n        })\n      });\n    });\n  })\n  // EDGES\n  useSubscription(() => {\n    const ref = collection(firestore, `${PATHS.projects}/${projectId}/${PATHS.edges}`)\n    onSnapshot(ref,querySnapshot => {\n      querySnapshot.docChanges().forEach(change => {\n        const data = change.doc.data()\n        onEvent({\n          elementType: 'edges',\n          data,\n          type: change.type,\n        })\n      });\n    });\n  })\n  \n}\n\ntype CreateNodeVariables = {\n  projectId: string;\n  item: any\n}\nexport async function createNode(variables: CreateNodeVariables) {\n  const {\n    projectId,\n    item\n  } = variables\n  try {\n    const id = R.uuid()\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.nodes}/${item.id}`)\n    setDoc(\n      ref,\n      item,\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype DeleteNodeVariables = {\n  id: string;\n  projectId: string;\n}\nexport async function deleteNode(variables: DeleteNodeVariables) {\n  const { \n    id,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.nodes}/${id}`)\n    deleteDoc(ref)\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype UpdateNodeVariables = {\n  item: any;\n  projectId: string;\n}\nexport async function updateNode(variables: UpdateNodeVariables) {\n  const {\n    item,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.nodes}/${item.id}`)\n    updateDoc(\n      ref,\n      {\n        data: item.data\n      }\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\n\ntype CreateEdgeVariables = {\n  projectId: string;\n  item: any\n}\nexport async function createEdge(variables: CreateEdgeVariables) {\n  const {\n    projectId,\n    item\n  } = variables\n  try {\n    const id = R.uuid()\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.edges}/${item.id}`)\n    setDoc(\n      ref,\n      item\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype DeleteEdgeVariables = {\n  id: string;\n  projectId: string;\n}\nexport async function deleteEdge(variables: DeleteEdgeVariables) {\n  const { \n    id,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.edges}/${id}`)\n    deleteDoc(ref)\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype UpdateEdgeVariables = {\n  item: any;\n  projectId: string;\n}\nexport async function updateEdge(variables: UpdateEdgeVariables) {\n  const {\n    item,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.edges}/${item.id}`)\n    updateDoc(\n      ref,\n      {\n        data: item.data\n      }\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\n\ntype UpdateUserVariables = {\n  user: any;\n  projectId: string;\n}\n\nexport async function updateUser(variables: UpdateUserVariables) {\n  const {\n    user,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.users}/${user.id}`)\n    setDoc(\n      ref,\n      user\n    )\n  } catch (err) {\n    console.log('error update user:', err)\n  }\n}\n\ntype DeleteUserVariables = {\n  id: string;\n  projectId: string;\n}\n\nexport async function deleteUser(variables: DeleteUserVariables) {\n  const {\n    id,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.users}/${id}`)\n    deleteDoc(\n      ref,\n    )\n  } catch (err) {\n    console.log('error deleting user:', err)\n  }\n}\n\nexport const useUserSubscription = (config: SubscriptionConfig) => { \n  const {\n     onEvent,\n     projectId,\n  } = config\n  useSubscription(() => {\n    const ref = collection(firestore, `${PATHS.projects}/${projectId}/${PATHS.users}`)\n    onSnapshot(ref,querySnapshot => {\n      querySnapshot.docChanges().forEach(change => {\n        const data = change.doc.data()\n        onEvent({\n          elementType: 'users',\n          data,\n          type: change.type,\n        })\n      });\n    });\n  })\n}\n\n// export function onCreateNode(callback: (node: any) => void) {\n//   try {\n//      return API.graphql({\n//       query: ON_CREATE_NODE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((nodeData) => {\n//       const nodeRaw = nodeData.value.data.onCreateNode\n//       callback(convertJSONStringFields(nodeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n// export function onUpdateNode(callback: (node: any) => void) {\n//   try {\n//      return API.graphql({\n//       query: ON_UPDATE_NODE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((nodeData) => {\n//       const nodeRaw = nodeData.value.data.onUpdateNode\n//       callback(convertJSONStringFields(nodeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n\n// export function onDeleteNode(callback: (id: string) => void) {\n//   try {\n//     return API.graphql({\n//       query: ON_DELETE_NODE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((nodeData) => {\n//       const nodeRaw = nodeData.value.data.onDeleteNode\n//       callback(nodeRaw.id)\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n\n// export function onCreateEdge(callback: (node: any) => void) {\n//   try {\n//      return API.graphql({\n//       query: ON_CREATE_EDGE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((edgeData) => {\n//       const edgeRaw = edgeData.value.data.onCreateEdge\n//       callback(convertJSONStringFields(edgeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n// export function onUpdateEdge(callback: (edge: any) => void) {\n//   try {\n//     return API.graphql({\n//       query: ON_UPDATE_EDGE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((edgeData) => {\n//       const edgeRaw = edgeData.value.data.onUpdateEdge\n//       callback(convertJSONStringFields(edgeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n// export function onDeleteEdge(callback: (id: string) => void) {\n//   try {\n//     return API.graphql({\n//       query: ON_DELETE_EDGE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((edgeData) => {\n//       const edgeRaw = edgeData.value.data.onDeleteEdge\n//       callback(edgeRaw.id)\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }","import React from 'react'\nimport { Graph } from 'perfect-graph'\nimport { Position } from 'colay/type'\nimport * as PIXI from 'pixi.js'\nimport  Vector from 'victor'\nimport  { Container } from '@inlet/react-pixi'\nimport Color from 'color'\n\nexport type MouseArrowProps = { \n  user: {id: string;};\n  color: number;\n  position: Position;\n  label: string;\n}\n\nconst SPEED = 5\n\nexport const MouseArrow: React.FC<MouseArrowProps> = ({ user, position, label }) => {\n  const localDataRef = React.useRef({\n    targetPosition: position,\n  })\n  const containerRef = React.useRef()\n  const color = React.useMemo(() => {\n    var randomColor = `#${Math.floor(Math.random()*16777215).toString(16)}`;\n    console.log('a', randomColor, Color(randomColor).rgbNumber())\n    return Color(randomColor).rgbNumber()\n  },  [user.id])\n  const draw = React.useCallback(g => {\n    // g.clear()\n    // g.beginFill(color)\n    // g.lineStyle(4, color, 1)\n    // g.moveTo(50, 50)\n    // g.endFill()\n    drawArrowHead({\n      graphics: g,\n      fill: color,\n      to: {x: 0, y: 0},\n      unitVector: { x: -2, y: -2 },\n    })\n  }, [color])\n  React.useMemo(() => {\n    localDataRef.current.targetPosition = position\n  }, [position])\n  React.useEffect(() => {\n    containerRef.current.x = position.x\n    containerRef.current.y = position.y\n    const tickerFunc = () => {\n      const container = containerRef.current\n      if (!container) {\n        return\n      }\n      const targetPosition = Vector.fromObject(localDataRef.current.targetPosition)\n      const currentPosition = Vector.fromObject(container)\n      const distance = targetPosition.clone().subtract(currentPosition)\n      const distanceLength = distance.length()\n      if (distanceLength < SPEED) {\n        container.x = targetPosition.x\n        container.y = targetPosition.y\n      } else {\n        const unitVector = distance.clone().normalize()\n        const newPosition = currentPosition.clone().add(unitVector.clone().multiplyScalar(SPEED))\n        container.x = newPosition.x\n        container.y = newPosition.y\n      }\n    }\n    PIXI.Ticker.shared.add(tickerFunc)\n    return () => {\n      PIXI.Ticker.shared.remove(tickerFunc)\n    }\n  }, [])\n  \n  return (\n    <Container\n      ref={containerRef}\n      x={0}\n      y={0}\n    >\n      <Graph.Graphics draw={draw}/>\n      <Graph.Text text={label} />\n    </Container>\n  )\n}\n\nconst drawArrowHead = ({\n  graphics,\n  to,\n  radius = 10,\n  unitVector,\n  fill,\n}: {\n  graphics: PIXI.Graphics;\n  unitVector: Position;\n  to: Position;\n  radius?: number;\n  fill: number;\n}) => {\n  const bottomCenter = Vector.fromObject(to)\n  const unitDistanceVec = Vector.fromObject(unitVector).multiplyScalar(radius)\n  const perpendicularUnitDistanceVec = unitDistanceVec.clone().rotate(-Math.PI / 2)\n  const leftControlPoint = perpendicularUnitDistanceVec\n    .clone()\n    .multiplyScalar(-1)\n    .add(bottomCenter)\n  const rightControlPoint = perpendicularUnitDistanceVec.clone().add(bottomCenter)\n  const topControlPoint = bottomCenter.clone().add(unitDistanceVec)\n  graphics.beginFill(fill)\n  graphics.drawPolygon(\n    new PIXI.Point(leftControlPoint.x, leftControlPoint.y),\n    new PIXI.Point(rightControlPoint.x, rightControlPoint.y),\n    new PIXI.Point(topControlPoint.x, topControlPoint.y),\n  )\n  // TODO: Dont remove the endFill\n  graphics.endFill()\n  // TODO: Check the performance effect of this later\n  // graphics.isSprite = true\n}\n","import React from 'react'\nimport { Graph, } from \"perfect-graph\";\nimport { GraphEditor, } from \"perfect-graph/components/GraphEditor\";\nimport { DefaultTheme } from \"perfect-graph/core/theme\";\nimport { getSelectedItemByElement, getSelectedElementInfo } from \"perfect-graph/utils\";\nimport { EVENT, EDITOR_MODE } from \"perfect-graph/constants\";\nimport { useController } from \"perfect-graph/plugins/controller\";\nimport { getPointerPositionOnViewport } from \"perfect-graph/utils\";\nimport * as API from \"../api/firebase\";\nimport * as R from \"colay/ramda\";\nimport { useImmer } from \"colay-ui/hooks/useImmer\";\nimport { MouseArrow } from './MouseArrow'\n\nconst PROJECT_ID = 'daa9975c-6bdc-4ab3-9a01-2d1dca1f2290'\n\ntype User = {\n  id: string;\n  name: string;\n  position: {\n    x: number;\n    y: number;\n  }\n}\n\n\n\nexport function MyGraphEditor(props: any) {\n  const {\n    width,\n    height,\n    userName,\n  } = props\n  const [state, updateState] = useImmer({\n    users: [] as User[],\n  })\n  const userId = React.useMemo(() => R.uuid(), [])\n  const localDataRef = React.useRef({\n    user: null,\n    mousePosition: {\n      x: 0,\n      y: 0,\n    },\n    userInitialized: false,\n  })\n  const [controllerProps, controller] = useController({\n    nodes: [],\n    edges: [],\n    dataBar: {\n      editable: true\n    },\n    networkStatistics: {\n      local: {\n\n      },\n    },\n    label: {\n      global: {\n        nodes: ['name'],\n        edges: ['name'],\n      },\n      edges: {},\n      nodes: {},\n    },\n    onEvent: ({\n      type,\n      payload,\n      elementId,\n      graphRef,\n      graphEditor,\n      update,\n      state,\n    }, draft) => {\n      const {\n        cy,\n        context: graphEditorContext\n      } = graphEditor\n      const element = cy.$id(elementId!)\n      const {\n        item: selectedItem,\n        index: selectedItemIndex,\n      } = (element && getSelectedItemByElement(element, draft)) ?? {}\n      switch (type) {\n        case EVENT.UPDATE_DATA: {\n          const {\n            value\n          } = payload\n          const {\n            type, selectedItem\n          } = getSelectedElementInfo(draft, graphEditor)\n          if (type === 'nodes') {\n            API.updateNode({\n              projectId: PROJECT_ID,\n              item: {\n                id: selectedItem.id,\n                data: value,\n              }\n            })\n          } else {\n            API.updateEdge({\n              projectId: PROJECT_ID,\n              item: {\n                id: selectedItem!.id,\n                data: value,\n              }\n            })\n          }\n          return false\n        }\n        case EVENT.ADD_NODE: {\n          const {\n            items,\n            edgeItems,\n          } = payload\n          // draft.nodes = draft.nodes.concat(items)\n          // draft.edges = draft.edges.concat(edgeItems ?? [])\n          // const { position } = payload\n          // draft.nodes.push({\n          //   id: `${draft.nodes.length + 1}`, // R.uuid(),\n          //   position,\n          //   data: [],\n          // })\n          items.forEach((item) => {\n            API.createNode({\n              projectId: PROJECT_ID,\n              item: {\n                ...item,\n                data: {\n                  ...item.data,\n                  name: `Node-${R.take(4, item.id)}`\n                }\n              }\n            })\n          })\n          if (draft.mode === EDITOR_MODE.ADD) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n        case EVENT.DELETE_NODE: {\n          const {\n            itemIds = [],\n          } = payload as {\n            itemIds: string[]\n          }\n          // draft.nodes = draft.nodes.filter((nodeItem) => !itemIds.includes(nodeItem.id))\n          // draft.edges = draft.edges.filter(\n          //   (edgeItem) => !itemIds.includes(edgeItem.source)\n          //   && !itemIds.includes(edgeItem.target),\n          // )\n          itemIds.forEach((id) => {\n            API.deleteNode({\n              projectId: PROJECT_ID,\n              id\n            })\n          })\n           draft.edges.forEach(\n            (edgeItem) => {\n              if (itemIds.includes(edgeItem.source)\n              || itemIds.includes(edgeItem.target)) {\n                API.deleteEdge({\n                  projectId: PROJECT_ID,\n                  id: edgeItem.id\n                })\n              }\n            },\n            )\n          if (draft.mode === EDITOR_MODE.DELETE) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n        case EVENT.ADD_EDGE: {\n          const {\n            items,\n          } = payload\n          items.forEach((item) => {\n            API.createEdge({\n              projectId: PROJECT_ID,\n              item: {\n                ...item,\n                data: {\n                  ...item.data,\n                  name: `Edge-${R.take(4, item.id)}`\n                }\n              }\n            })\n          })\n          if (draft.mode === EDITOR_MODE.ADD) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n        case EVENT.DELETE_EDGE: {\n          const {\n            itemIds = [],\n          } = payload as {\n            itemIds: string[]\n          }\n          itemIds.forEach((id) => {\n            API.deleteEdge({\n              projectId: PROJECT_ID,\n              id\n            })\n          })\n          if (draft.mode === EDITOR_MODE.DELETE) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n      //   case EVENT.MODE_CHANGED: {\n      //     targetNodeRef.current = null\n      //     break\n      //   }\n        default:\n          break;\n      }\n    }\n  });\n  const graphEditorRef = controllerProps.ref\n  const removeUser = React.useCallback(() => {\n    localDataRef.current.user = null\n    API.deleteUser({\n      projectId: PROJECT_ID,\n      id: userId\n    })\n  }, [userId])\n  const  createUser = React.useCallback(() => {\n    const user = {\n      id: userId,\n      name: userName,\n      position: localDataRef.current.mousePosition\n    }\n    localDataRef.current.user = user\n    API.updateUser({\n      projectId: PROJECT_ID,\n      user\n    })\n    return user\n  }, [userId])\n  API.useProjectSubscription({\n    projectId: PROJECT_ID,\n    onEvent: (event) => {\n       const {\n        type,\n        data,\n        elementType\n       } = event\n       controller.update((draft) => {\n        const targetList = draft[elementType]\n        switch (type) {\n          case 'added':\n            targetList.push(data)\n            break;\n          case 'modified':{\n            targetList.forEach(\n              (item, index) => {\n                if (item.id === data.id) {\n                  targetList[index] = data\n                }\n              }\n            )\n            // .filter((item) => item.id !== data.id)))\n            break;\n          }\n          case 'removed':\n            draft[elementType] = targetList.filter(\n              (item) => item.id !== data.id\n            )\n            if (elementType === 'nodes') {\n              draft.edges = draft.edges.filter(\n            (edgeItem) => data.id !==edgeItem.source\n              && data.id !== edgeItem.target,\n            )\n            }\n            break;\n        \n          default:\n            break;\n        }\n       })\n    }\n  })\n  API.useUserSubscription({\n    projectId: PROJECT_ID,\n    onEvent: (event) => {\n       const {\n        type,\n        data,\n        elementType\n       } = event\n       if (data.id === userId) {\n         return\n       }\n       updateState((draft) => {\n        switch (type) {\n          case 'added':\n            draft.users.push(data)\n            break;\n          case 'modified':{\n            draft.users.forEach(\n              (item, index) => {\n                if (item.id === data.id) {\n                  draft.users[index] = data\n                }\n              }\n            )\n            break;\n          }\n          case 'removed':\n            draft.users = draft.users.filter(\n              (item) => item.id !== data.id\n            )\n            break;\n        \n          default:\n            break;\n        }\n       })\n    }\n  })\n  React.useEffect(() => {\n    const handleWindowChange = (type: string) => (e) => {\n      switch (type) {\n        case 'visibilitychange':\n          if (document.visibilityState === 'visible') {\n            createUser()\n          } else {\n            removeUser()\n          }          \n          break;\n        case 'focus':\n          createUser()\n          break;\n        case 'blur':\n          removeUser()\n          break;\n        case 'blur':\n          removeUser()\n          break;\n        case 'beforeunload':\n          removeUser()\n          break;\n      \n        default:\n          break;\n      }\n      console.log('Focus change', e)\n    }\n    const focusHandler = handleWindowChange('focus')\n    const blurHandler = handleWindowChange('blur')\n    const visibilityChangeHandler = handleWindowChange('visibilitychange')\n    const beforeUnloadHandler = handleWindowChange('beforeunload')\n    window.addEventListener('visibilitychange', visibilityChangeHandler, false)\n    window.addEventListener('blur', blurHandler, false)\n    window.addEventListener('focus', focusHandler, false)\n    window.addEventListener('beforeunload', beforeUnloadHandler, false);\n    let isTrackRef = {\n      current: true\n    }\n    const interval = setInterval(() => {\n      isTrackRef.current = true\n    }, 1000)\n    const debounced = R.debounce((event) => {\n        // if (isTrackRef.current) {\n          isTrackRef.current = false\n          const position = getPointerPositionOnViewport(\n            graphEditorRef.current.viewport,\n            event\n          )\n          API.updateUser({\n            projectId: PROJECT_ID,\n            user: {\n              id: userId,\n              name: userName,\n              position\n            }\n          })\n        // }\n      }, 500)\n    const onMouseMove = (event) => {\n      localDataRef.current.mousePosition = getPointerPositionOnViewport(\n        graphEditorRef.current.viewport,\n        event\n      )\n      if (!localDataRef.current.user && !localDataRef.current.userInitialized) {\n        localDataRef.current.userInitialized = true\n        createUser()\n      }\n      debounced(event)\n    }\n    document.addEventListener('mousemove', onMouseMove)\n    return () => {\n      API.deleteUser({\n        projectId: PROJECT_ID,\n        id: userId\n      })\n      clearInterval(interval)\n      document.removeEventListener('mousemove', onMouseMove)\n      window.removeEventListener('visibilitychange', visibilityChangeHandler, false)\n      window.removeEventListener('blur', blurHandler, false)\n      window.removeEventListener('focus', focusHandler, false)\n      window.removeEventListener('beforeunload', beforeUnloadHandler, false);\n    }\n  }, [])\n  return (\n    <GraphEditor\n      style={{ width, height }}\n      {...controllerProps}\n    >\n      {\n        state.users.map((user) => userId !== user.id && (\n          // <Graph.View\n          //   width={10}\n          //   height={10}\n          //   fill={DefaultTheme.palette.primary.main}\n          //   x={user.position.x}\n          //   y={user.position.y}\n          // >\n          //   <Graph.Text text={R.takeLast(4, user.id)} />\n          // </Graph.View>\n          <MouseArrow \n            key={user.id}\n            user={user}\n            color={0xff3300}\n            position={user.position}\n            label={user.name}\n          />\n        ))\n      }\n    </GraphEditor>\n  );\n}","import Button from '@mui/material/Button';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport TextField from '@mui/material/TextField';\nimport React from 'react';\n\nexport type GetNameDialogProps = { \n  onSubmit: (name: string) => void;\n}\n\nexport const  GetNameDialog = (props: GetNameDialogProps) => {\n  const {\n    onSubmit,\n  } = props\n  const [name, setName] = React.useState('');\n  return (\n      <Dialog open={true}>\n        <DialogTitle>Set Your Name</DialogTitle>\n        <DialogContent>\n          {/* <DialogContentText>\n            To subscribe to this website, please enter your email address here. We\n            will send updates occasionally.\n          </DialogContentText> */}\n          <TextField\n            autoFocus\n            margin=\"dense\"\n            id=\"name\"\n            label=\"User name\"\n            fullWidth\n            variant=\"standard\"\n            value={name}\n            onChange={e => setName(e.target.value)}\n            onKeyPress={(e) => {\n              if (e.key === 'Enter') {\n                onSubmit(name)\n              }\n            }}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => onSubmit(name)}>Start</Button>\n        </DialogActions>\n      </Dialog>\n  );\n}","import React from 'react'\nimport { StyleSheet, Text, View, ActivityIndicator } from 'react-native';\nimport { MyGraphEditor } from './components/GraphEditor'\nimport { GetNameDialog } from './components/GetNameDialog'\nimport {  useLayout } from 'colay-ui'\nimport {  useImmer } from 'colay-ui/hooks/useImmer'\nimport { useAuth } from './api/firebase'\nimport  { Button } from '@mui/material'\nexport default function App() {\n  const {\n    width,\n    height,\n    onLayout,\n  } = useLayout()\n  const [state, updateState] = useImmer({\n    isLoading: true,\n    name: ''\n  })\n  const auth = useAuth()\n  console.log('Auth result', auth)\n  if (auth.isLoading) {\n    return (\n      <ActivityIndicator />\n    )\n  }\n  if (!auth.user) {\n    return (\n      <Button\n        onClick={() => auth.signin()}\n      >\n        Signin\n      </Button>\n    )\n  }\n  return (\n    <View\n      style={styles.container}\n      onLayout={onLayout}\n    >\n     {\n       state.isLoading\n       ? (\n          <GetNameDialog \n            onSubmit={(name) => {\n              updateState((draft)=> {\n                draft.isLoading = false\n                draft.name = name\n              })\n            }}\n          />\n       )\n       : (\n        <MyGraphEditor\n          {...{\n            width,\n            height,\n          }}\n          userName={state.name}\n        />\n       )\n     }\n    </View>\n  );\n}\n\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n});\n"],"sourceRoot":""}