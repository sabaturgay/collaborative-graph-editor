{"version":3,"sources":["api/firebase.ts","components/MouseArrow.tsx","components/GraphEditor.tsx","components/GetNameDialog.tsx","App.tsx"],"names":["app","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","firestore","getAnalytics","getFirestore","auth","getAuth","PATHS","deleteEdge","variables","a","async","id","ref","doc","deleteDoc","err","console","log","updateUser","user","setDoc","deleteUser","MouseArrow","position","label","localDataRef","React","useRef","targetPosition","containerRef","color","useMemo","randomColor","Math","floor","random","toString","Color","rgbNumber","draw","useCallback","g","drawArrowHead","graphics","fill","to","x","y","unitVector","current","useEffect","tickerFunc","container","Vector","fromObject","currentPosition","distance","clone","subtract","length","normalize","newPosition","add","multiplyScalar","PIXI","shared","remove","Graphics","Text","text","radius","bottomCenter","unitDistanceVec","perpendicularUnitDistanceVec","rotate","PI","leftControlPoint","rightControlPoint","topControlPoint","beginFill","drawPolygon","endFill","PROJECT_ID","overrideTheme","theme","Object","keys","typography","forEach","key","fontSize","Number","replace","MUI_THEMES","Dark","createMuiTheme","palette","mode","spacing","components","MuiTextField","defaultProps","size","Default","THEMES","DarkTheme","DefaultTheme","MyGraphEditor","props","width","height","userName","useImmer","users","state","updateState","useState","setTheme","userId","R","mousePosition","userInitialized","useController","nodes","edges","dataBar","editable","actionBar","theming","options","name","value","networkStatistics","local","global","onEvent","draft","type","payload","elementId","graphEditor","graphRef","cy","update","element","context","$id","getSelectedItemByElement","item","index","EVENT","UPDATE_DATA","getSelectedElementInfo","selectedItem","updateDoc","data","API","ADD_NODE","items","edgeItems","EDITOR_MODE","ADD","DEFAULT","DELETE_NODE","itemIds","edgeItem","includes","source","target","DELETE","ADD_EDGE","DELETE_EDGE","CHANGE_THEME","graphConfig","controllerProps","controller","graphEditorRef","removeUser","createUser","config","useSubscription","collection","onSnapshot","querySnapshot","docChanges","change","elementType","event","targetList","push","filter","handleWindowChange","e","document","visibilityState","focusHandler","blurHandler","visibilityChangeHandler","beforeUnloadHandler","window","addEventListener","isTrackRef","interval","setInterval","debounced","getPointerPositionOnViewport","viewport","onMouseMove","clearInterval","removeEventListener","GraphEditor","style","map","GetNameDialog","onSubmit","setName","Dialog","open","DialogTitle","DialogContent","TextField","autoFocus","margin","fullWidth","variant","onChange","onKeyPress","DialogActions","Button","onClick","App","useLayout","onLayout","isLoading","signin","signInWithPopup","GoogleAuthProvider","result","alert","Promise","res","rej","onAuthStateChanged","error","call","useAuth","ActivityIndicator","View","styles","StyleSheet","create","flex","backgroundColor","alignItems","justifyContent"],"mappings":"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","file":"static/js/app.ae580508.chunk.js","sourcesContent":["import React from 'react'\n// Import the functions you need from the SDKs you need\nimport { initializeApp } from \"firebase/app\";\nimport { getAnalytics } from \"firebase/analytics\";\nimport { \n  getFirestore,addDoc, updateDoc, doc,\n  onSnapshot, collection,  deleteDoc, setDoc,\n } from \"firebase/firestore\";\n import { getAuth, signInWithPopup, GoogleAuthProvider } from \"firebase/auth\";\nimport { useSubscription,   } from 'colay-ui'\nimport { useImmer,   } from 'colay-ui/hooks/useImmer'\nimport * as R from 'colay/ramda'\n// TODO: Add SDKs for Firebase products that you want to use\n// https://firebase.google.com/docs/web/setup#available-libraries\n\n\n// Your web app's Firebase configuration\n// For Firebase JS SDK v7.20.0 and later, measurementId is optional\nconst firebaseConfig = {\n  apiKey: \"AIzaSyB8I11ntIAhLCoz2iw2cWVZl6NoWQ44yR0\",\n  authDomain: \"perfectgraph-5c619.firebaseapp.com\",\n  databaseURL: \"https://perfectgraph-5c619.firebaseio.com\",\n  projectId: \"perfectgraph-5c619\",\n  storageBucket: \"perfectgraph-5c619.appspot.com\",\n  messagingSenderId: \"214633043236\",\n  appId: \"1:214633043236:web:fa42d761199303b786cfb1\",\n  measurementId: \"G-GYX9R6E88Y\"\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst analytics = getAnalytics(app);\nconst firestore = getFirestore(app);\nconst auth = getAuth(app);\n\nconst PATHS = {\n  projects: 'projects',\n  nodes: 'nodes',\n  edges: 'edges',\n  users: 'users',\n}\n\nexport const useAuth = () => {\n  const [state, updateState] = useImmer({\n    user: null,\n    isLoading: true,\n    signin: async () => {\n      try {\n        updateState(draft => {\n          draft.isLoading = true\n        })\n        const result = await signInWithPopup(auth, new GoogleAuthProvider())\n        // const credential = GoogleAuthProvider.credentialFromResult(result);\n        // const token = credential.accessToken;\n        console.log('AA', result)\n        const user = result.user;\n        updateState(draft => {\n          draft.isLoading = false\n          draft.user = user\n        })\n      } catch (error) {\n        alert('There is an error with your login! Refresh the page and try again!')\n        console.log('error', error)\n        // const errorCode = error.code;\n        //   const errorMessage = error.message;\n        //   // The email of the user's account used.\n        //   const email = error.email;\n        //   // The AuthCredential type that was used.\n        //   const credential = GoogleAuthProvider.credentialFromError(error);\n      }\n    }\n  })\n  React.useEffect(() => {\n    const call = async () => {\n      const user = await new Promise((res, rej) => {\n        auth.onAuthStateChanged((user, error) => {\n          res(user)\n        })\n      })\n      updateState((draft) => {\n        draft.isLoading = false\n        draft.user = user \n      })\n    }\n    call()\n  }, [])\n  return state\n}\n\ntype Event = {\n  type: string;\n  elementType: 'nodes' | 'edges' | 'users';\n  data: any\n}\ntype SubscriptionConfig = {\n  projectId: string;\n  onEvent: (event: Event) => void;\n}\n\nexport const useProjectSubscription = (config: SubscriptionConfig) => { \n  const {\n     onEvent,\n     projectId,\n  } = config\n  // useSubscription(() => {\n  //   const ref = doc(firestore, `${PATHS.projects}/${projectId}`)\n  //     onSnapshot(ref,querySnapshot => {\n  //       const data = querySnapshot.data()\n\n  //     });\n  // })\n  // NODES\n  useSubscription(() => {\n    const ref = collection(firestore, `${PATHS.projects}/${projectId}/${PATHS.nodes}`)\n    onSnapshot(ref,querySnapshot => {\n      querySnapshot.docChanges().forEach(change => {\n        const data = change.doc.data()\n        onEvent({\n          elementType: 'nodes',\n          data,\n          type: change.type,\n        })\n      });\n    });\n  })\n  // EDGES\n  useSubscription(() => {\n    const ref = collection(firestore, `${PATHS.projects}/${projectId}/${PATHS.edges}`)\n    onSnapshot(ref,querySnapshot => {\n      querySnapshot.docChanges().forEach(change => {\n        const data = change.doc.data()\n        onEvent({\n          elementType: 'edges',\n          data,\n          type: change.type,\n        })\n      });\n    });\n  })\n  \n}\n\ntype CreateNodeVariables = {\n  projectId: string;\n  item: any\n}\nexport async function createNode(variables: CreateNodeVariables) {\n  const {\n    projectId,\n    item\n  } = variables\n  try {\n    const id = R.uuid()\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.nodes}/${item.id}`)\n    setDoc(\n      ref,\n      item,\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype DeleteNodeVariables = {\n  id: string;\n  projectId: string;\n}\nexport async function deleteNode(variables: DeleteNodeVariables) {\n  const { \n    id,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.nodes}/${id}`)\n    deleteDoc(ref)\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype UpdateNodeVariables = {\n  item: any;\n  projectId: string;\n}\nexport async function updateNode(variables: UpdateNodeVariables) {\n  const {\n    item,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.nodes}/${item.id}`)\n    updateDoc(\n      ref,\n      {\n        data: item.data\n      }\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\n\ntype CreateEdgeVariables = {\n  projectId: string;\n  item: any\n}\nexport async function createEdge(variables: CreateEdgeVariables) {\n  const {\n    projectId,\n    item\n  } = variables\n  try {\n    const id = R.uuid()\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.edges}/${item.id}`)\n    setDoc(\n      ref,\n      item\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype DeleteEdgeVariables = {\n  id: string;\n  projectId: string;\n}\nexport async function deleteEdge(variables: DeleteEdgeVariables) {\n  const { \n    id,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.edges}/${id}`)\n    deleteDoc(ref)\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype UpdateEdgeVariables = {\n  item: any;\n  projectId: string;\n}\nexport async function updateEdge(variables: UpdateEdgeVariables) {\n  const {\n    item,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.edges}/${item.id}`)\n    updateDoc(\n      ref,\n      {\n        data: item.data\n      }\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\n\ntype UpdateUserVariables = {\n  user: any;\n  projectId: string;\n}\n\nexport async function updateUser(variables: UpdateUserVariables) {\n  const {\n    user,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.users}/${user.id}`)\n    setDoc(\n      ref,\n      user\n    )\n  } catch (err) {\n    console.log('error update user:', err)\n  }\n}\n\ntype DeleteUserVariables = {\n  id: string;\n  projectId: string;\n}\n\nexport async function deleteUser(variables: DeleteUserVariables) {\n  const {\n    id,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.users}/${id}`)\n    deleteDoc(\n      ref,\n    )\n  } catch (err) {\n    console.log('error deleting user:', err)\n  }\n}\n\nexport const useUserSubscription = (config: SubscriptionConfig) => { \n  const {\n     onEvent,\n     projectId,\n  } = config\n  useSubscription(() => {\n    const ref = collection(firestore, `${PATHS.projects}/${projectId}/${PATHS.users}`)\n    onSnapshot(ref,querySnapshot => {\n      querySnapshot.docChanges().forEach(change => {\n        const data = change.doc.data()\n        onEvent({\n          elementType: 'users',\n          data,\n          type: change.type,\n        })\n      });\n    });\n  })\n}\n\n// export function onCreateNode(callback: (node: any) => void) {\n//   try {\n//      return API.graphql({\n//       query: ON_CREATE_NODE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((nodeData) => {\n//       const nodeRaw = nodeData.value.data.onCreateNode\n//       callback(convertJSONStringFields(nodeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n// export function onUpdateNode(callback: (node: any) => void) {\n//   try {\n//      return API.graphql({\n//       query: ON_UPDATE_NODE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((nodeData) => {\n//       const nodeRaw = nodeData.value.data.onUpdateNode\n//       callback(convertJSONStringFields(nodeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n\n// export function onDeleteNode(callback: (id: string) => void) {\n//   try {\n//     return API.graphql({\n//       query: ON_DELETE_NODE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((nodeData) => {\n//       const nodeRaw = nodeData.value.data.onDeleteNode\n//       callback(nodeRaw.id)\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n\n// export function onCreateEdge(callback: (node: any) => void) {\n//   try {\n//      return API.graphql({\n//       query: ON_CREATE_EDGE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((edgeData) => {\n//       const edgeRaw = edgeData.value.data.onCreateEdge\n//       callback(convertJSONStringFields(edgeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n// export function onUpdateEdge(callback: (edge: any) => void) {\n//   try {\n//     return API.graphql({\n//       query: ON_UPDATE_EDGE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((edgeData) => {\n//       const edgeRaw = edgeData.value.data.onUpdateEdge\n//       callback(convertJSONStringFields(edgeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n// export function onDeleteEdge(callback: (id: string) => void) {\n//   try {\n//     return API.graphql({\n//       query: ON_DELETE_EDGE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((edgeData) => {\n//       const edgeRaw = edgeData.value.data.onDeleteEdge\n//       callback(edgeRaw.id)\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }","import React from 'react'\nimport { Graph } from 'perfect-graph'\nimport { Position } from 'colay/type'\nimport * as PIXI from 'pixi.js'\nimport  Vector from 'victor'\nimport  { Container } from '@inlet/react-pixi'\nimport Color from 'color'\n\nexport type MouseArrowProps = { \n  user: {id: string;};\n  color: number;\n  position: Position;\n  label: string;\n}\n\nconst SPEED = 5\n\nexport const MouseArrow: React.FC<MouseArrowProps> = ({ user, position, label }) => {\n  const localDataRef = React.useRef({\n    targetPosition: position,\n  })\n  const containerRef = React.useRef()\n  const color = React.useMemo(() => {\n    var randomColor = `#${Math.floor(Math.random()*16777215).toString(16)}`;\n    console.log('a', randomColor, Color(randomColor).rgbNumber())\n    return Color(randomColor).rgbNumber()\n  },  [user.id])\n  const draw = React.useCallback(g => {\n    // g.clear()\n    // g.beginFill(color)\n    // g.lineStyle(4, color, 1)\n    // g.moveTo(50, 50)\n    // g.endFill()\n    drawArrowHead({\n      graphics: g,\n      fill: color,\n      to: {x: 0, y: 0},\n      unitVector: { x: -2, y: -2 },\n    })\n  }, [color])\n  React.useMemo(() => {\n    localDataRef.current.targetPosition = position\n  }, [position])\n  React.useEffect(() => {\n    containerRef.current.x = position.x\n    containerRef.current.y = position.y\n    const tickerFunc = () => {\n      const container = containerRef.current\n      if (!container) {\n        return\n      }\n      const targetPosition = Vector.fromObject(localDataRef.current.targetPosition)\n      const currentPosition = Vector.fromObject(container)\n      const distance = targetPosition.clone().subtract(currentPosition)\n      const distanceLength = distance.length()\n      if (distanceLength < SPEED) {\n        container.x = targetPosition.x\n        container.y = targetPosition.y\n      } else {\n        const unitVector = distance.clone().normalize()\n        const newPosition = currentPosition.clone().add(unitVector.clone().multiplyScalar(SPEED))\n        container.x = newPosition.x\n        container.y = newPosition.y\n      }\n    }\n    PIXI.Ticker.shared.add(tickerFunc)\n    return () => {\n      PIXI.Ticker.shared.remove(tickerFunc)\n    }\n  }, [])\n  \n  return (\n    <Container\n      ref={containerRef}\n      x={0}\n      y={0}\n    >\n      <Graph.Graphics draw={draw}/>\n      <Graph.Text text={label} />\n    </Container>\n  )\n}\n\nconst drawArrowHead = ({\n  graphics,\n  to,\n  radius = 10,\n  unitVector,\n  fill,\n}: {\n  graphics: PIXI.Graphics;\n  unitVector: Position;\n  to: Position;\n  radius?: number;\n  fill: number;\n}) => {\n  const bottomCenter = Vector.fromObject(to)\n  const unitDistanceVec = Vector.fromObject(unitVector).multiplyScalar(radius)\n  const perpendicularUnitDistanceVec = unitDistanceVec.clone().rotate(-Math.PI / 2)\n  const leftControlPoint = perpendicularUnitDistanceVec\n    .clone()\n    .multiplyScalar(-1)\n    .add(bottomCenter)\n  const rightControlPoint = perpendicularUnitDistanceVec.clone().add(bottomCenter)\n  const topControlPoint = bottomCenter.clone().add(unitDistanceVec)\n  graphics.beginFill(fill)\n  graphics.drawPolygon(\n    new PIXI.Point(leftControlPoint.x, leftControlPoint.y),\n    new PIXI.Point(rightControlPoint.x, rightControlPoint.y),\n    new PIXI.Point(topControlPoint.x, topControlPoint.y),\n  )\n  // TODO: Dont remove the endFill\n  graphics.endFill()\n  // TODO: Check the performance effect of this later\n  // graphics.isSprite = true\n}\n","import {\n  createTheme as createMuiTheme,\n  ThemeProvider as MuiThemeProvider\n} from '@mui/material';\nimport { useImmer } from \"colay-ui/hooks/useImmer\";\nimport * as R from \"colay/ramda\";\nimport { GraphEditor } from \"perfect-graph/components/GraphEditor\";\nimport { EDITOR_MODE, EVENT } from \"perfect-graph/constants\";\nimport { DarkTheme, DefaultTheme } from \"perfect-graph/core/theme\";\nimport { useController } from \"perfect-graph/plugins/controller\";\nimport { getPointerPositionOnViewport, getSelectedElementInfo, getSelectedItemByElement } from \"perfect-graph/utils\";\nimport React from 'react';\nimport * as API from \"../api/firebase\";\nimport { MouseArrow } from './MouseArrow';\n\nconst PROJECT_ID = 'daa9975c-6bdc-4ab3-9a01-2d1dca1f2290'\n\ntype User = {\n  id: string;\n  name: string;\n  position: {\n    x: number;\n    y: number;\n  }\n}\n\nconst overrideTheme = (theme) => {\n  Object.keys(theme.typography).forEach((key) => {\n    if (theme.typography[key]?.fontSize) {\n      theme.typography[key].fontSize = Number(\n        theme.typography[key].fontSize.replace('rem', '')\n        ) * 16  * 0.8\n    }\n  })\n  return theme\n}\n\nconst MUIDarkTheme = overrideTheme(\n  createMuiTheme({\n    palette: {\n      mode: 'dark',\n    },\n    spacing: 4,\n    components: {\n      MuiTextField: {\n        defaultProps: {\n          size: 'small'\n        }\n      }\n    }\n  })\n)\n\nconst MUILightTheme = overrideTheme(\n  createMuiTheme({\n    palette: {\n      mode: 'light',\n    },\n    spacing: 4,\n    components: {\n      MuiTextField: {\n        defaultProps: {\n          size: 'small'\n        }\n      }\n    }\n  })\n)\n\nconst MUI_THEMES = {\n  Dark: MUIDarkTheme,\n  Default: MUILightTheme,\n}\n\nconst THEMES = {\n  Dark: DarkTheme,\n  Default: DefaultTheme\n}\n\n\nexport function MyGraphEditor(props: any) {\n  const {\n    width,\n    height,\n    userName,\n  } = props\n  const [state, updateState] = useImmer({\n    users: [] as User[],\n  })\n  const [theme, setTheme] = React.useState(MUI_THEMES.Default)\n  const userId = React.useMemo(() => R.uuid(), [])\n  const localDataRef = React.useRef({\n    user: null,\n    mousePosition: {\n      x: 0,\n      y: 0,\n    },\n    userInitialized: false,\n  })\n  const [controllerProps, controller] = useController({\n    nodes: [],\n    edges: [],\n    dataBar: {\n      editable: true\n    },\n    actionBar: {\n      theming: {\n        options: [\n          { name: 'Light', value: 'Default' },\n          { name: 'Dark', value: 'Dark' },\n        ],\n        value: 'Default',\n      }\n    },\n    networkStatistics: {\n      local: {\n\n      },\n    },\n    label: {\n      global: {\n        nodes: ['name'],\n        edges: ['name'],\n      },\n      edges: {},\n      nodes: {},\n    },\n    onEvent: ({\n      type,\n      payload,\n      elementId,\n      graphRef,\n      graphEditor,\n      update,\n      state,\n    }, draft) => {\n      const {\n        cy,\n        context: graphEditorContext\n      } = graphEditor\n      const element = cy.$id(elementId!)\n      const {\n        item: selectedItem,\n        index: selectedItemIndex,\n      } = (element && getSelectedItemByElement(element, draft)) ?? {}\n      switch (type) {\n        \n        case EVENT.UPDATE_DATA: {\n          const {\n            value\n          } = payload\n          const {\n            type, selectedItem\n          } = getSelectedElementInfo(draft, graphEditor)\n          if (type === 'nodes') {\n            API.updateNode({\n              projectId: PROJECT_ID,\n              item: {\n                id: selectedItem.id,\n                data: value,\n              }\n            })\n          } else {\n            API.updateEdge({\n              projectId: PROJECT_ID,\n              item: {\n                id: selectedItem!.id,\n                data: value,\n              }\n            })\n          }\n          return false\n        }\n        case EVENT.ADD_NODE: {\n          const {\n            items,\n            edgeItems,\n          } = payload\n          // draft.nodes = draft.nodes.concat(items)\n          // draft.edges = draft.edges.concat(edgeItems ?? [])\n          // const { position } = payload\n          // draft.nodes.push({\n          //   id: `${draft.nodes.length + 1}`, // R.uuid(),\n          //   position,\n          //   data: [],\n          // })\n          items.forEach((item) => {\n            API.createNode({\n              projectId: PROJECT_ID,\n              item: {\n                ...item,\n                data: {\n                  ...item.data,\n                  name: `Node-${R.take(4, item.id)}`\n                }\n              }\n            })\n          })\n          if (draft.mode === EDITOR_MODE.ADD) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n        case EVENT.DELETE_NODE: {\n          const {\n            itemIds = [],\n          } = payload as {\n            itemIds: string[]\n          }\n          // draft.nodes = draft.nodes.filter((nodeItem) => !itemIds.includes(nodeItem.id))\n          // draft.edges = draft.edges.filter(\n          //   (edgeItem) => !itemIds.includes(edgeItem.source)\n          //   && !itemIds.includes(edgeItem.target),\n          // )\n          itemIds.forEach((id) => {\n            API.deleteNode({\n              projectId: PROJECT_ID,\n              id\n            })\n          })\n           draft.edges.forEach(\n            (edgeItem) => {\n              if (itemIds.includes(edgeItem.source)\n              || itemIds.includes(edgeItem.target)) {\n                API.deleteEdge({\n                  projectId: PROJECT_ID,\n                  id: edgeItem.id\n                })\n              }\n            },\n            )\n          if (draft.mode === EDITOR_MODE.DELETE) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n        case EVENT.ADD_EDGE: {\n          const {\n            items,\n          } = payload\n          items.forEach((item) => {\n            API.createEdge({\n              projectId: PROJECT_ID,\n              item: {\n                ...item,\n                data: {\n                  ...item.data,\n                  name: `Edge-${R.take(4, item.id)}`\n                }\n              }\n            })\n          })\n          if (draft.mode === EDITOR_MODE.ADD) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n        case EVENT.DELETE_EDGE: {\n          const {\n            itemIds = [],\n          } = payload as {\n            itemIds: string[]\n          }\n          itemIds.forEach((id) => {\n            API.deleteEdge({\n              projectId: PROJECT_ID,\n              id\n            })\n          })\n          if (draft.mode === EDITOR_MODE.DELETE) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n        case EVENT.CHANGE_THEME: {\n          const {\n            value\n          } = payload\n          console.log('CHANGE_THEME',payload,value)\n          draft.graphConfig.theme = THEMES[value]\n          setTheme(MUI_THEMES[value])\n          draft.actionBar.theming.value = value\n          return false\n        }\n      //   case EVENT.MODE_CHANGED: {\n      //     targetNodeRef.current = null\n      //     break\n      //   }\n        default:\n          break;\n      }\n    }\n  });\n  const graphEditorRef = controllerProps.ref\n  const removeUser = React.useCallback(() => {\n    localDataRef.current.user = null\n    API.deleteUser({\n      projectId: PROJECT_ID,\n      id: userId\n    })\n  }, [userId])\n  const  createUser = React.useCallback(() => {\n    const user = {\n      id: userId,\n      name: userName,\n      position: localDataRef.current.mousePosition\n    }\n    localDataRef.current.user = user\n    API.updateUser({\n      projectId: PROJECT_ID,\n      user\n    })\n    return user\n  }, [userId])\n  API.useProjectSubscription({\n    projectId: PROJECT_ID,\n    onEvent: (event) => {\n       const {\n        type,\n        data,\n        elementType\n       } = event\n       controller.update((draft) => {\n        const targetList = draft[elementType]\n        switch (type) {\n          case 'added':\n            targetList.push(data)\n            break;\n          case 'modified':{\n            targetList.forEach(\n              (item, index) => {\n                if (item.id === data.id) {\n                  targetList[index] = data\n                }\n              }\n            )\n            // .filter((item) => item.id !== data.id)))\n            break;\n          }\n          case 'removed':\n            draft[elementType] = targetList.filter(\n              (item) => item.id !== data.id\n            )\n            if (elementType === 'nodes') {\n              draft.edges = draft.edges.filter(\n            (edgeItem) => data.id !==edgeItem.source\n              && data.id !== edgeItem.target,\n            )\n            }\n            break;\n        \n          default:\n            break;\n        }\n       })\n    }\n  })\n  API.useUserSubscription({\n    projectId: PROJECT_ID,\n    onEvent: (event) => {\n       const {\n        type,\n        data,\n        elementType\n       } = event\n       if (data.id === userId) {\n         return\n       }\n       updateState((draft) => {\n        switch (type) {\n          case 'added':\n            draft.users.push(data)\n            break;\n          case 'modified':{\n            draft.users.forEach(\n              (item, index) => {\n                if (item.id === data.id) {\n                  draft.users[index] = data\n                }\n              }\n            )\n            break;\n          }\n          case 'removed':\n            draft.users = draft.users.filter(\n              (item) => item.id !== data.id\n            )\n            break;\n        \n          default:\n            break;\n        }\n       })\n    }\n  })\n  React.useEffect(() => {\n    const handleWindowChange = (type: string) => (e) => {\n      switch (type) {\n        case 'visibilitychange':\n          if (document.visibilityState === 'visible') {\n            createUser()\n          } else {\n            removeUser()\n          }          \n          break;\n        case 'focus':\n          createUser()\n          break;\n        case 'blur':\n          removeUser()\n          break;\n        case 'blur':\n          removeUser()\n          break;\n        case 'beforeunload':\n          removeUser()\n          break;\n      \n        default:\n          break;\n      }\n      console.log('Focus change', e)\n    }\n    const focusHandler = handleWindowChange('focus')\n    const blurHandler = handleWindowChange('blur')\n    const visibilityChangeHandler = handleWindowChange('visibilitychange')\n    const beforeUnloadHandler = handleWindowChange('beforeunload')\n    window.addEventListener('visibilitychange', visibilityChangeHandler, false)\n    window.addEventListener('blur', blurHandler, false)\n    window.addEventListener('focus', focusHandler, false)\n    window.addEventListener('beforeunload', beforeUnloadHandler, false);\n    let isTrackRef = {\n      current: true\n    }\n    const interval = setInterval(() => {\n      isTrackRef.current = true\n    }, 1000)\n    const debounced = R.debounce((event) => {\n        // if (isTrackRef.current) {\n          isTrackRef.current = false\n          const position = getPointerPositionOnViewport(\n            graphEditorRef.current.viewport,\n            event\n          )\n          API.updateUser({\n            projectId: PROJECT_ID,\n            user: {\n              id: userId,\n              name: userName,\n              position\n            }\n          })\n        // }\n      }, 500)\n    const onMouseMove = (event) => {\n      localDataRef.current.mousePosition = getPointerPositionOnViewport(\n        graphEditorRef.current.viewport,\n        event\n      )\n      if (!localDataRef.current.user && !localDataRef.current.userInitialized) {\n        localDataRef.current.userInitialized = true\n        createUser()\n      }\n      debounced(event)\n    }\n    document.addEventListener('mousemove', onMouseMove)\n    return () => {\n      API.deleteUser({\n        projectId: PROJECT_ID,\n        id: userId\n      })\n      clearInterval(interval)\n      document.removeEventListener('mousemove', onMouseMove)\n      window.removeEventListener('visibilitychange', visibilityChangeHandler, false)\n      window.removeEventListener('blur', blurHandler, false)\n      window.removeEventListener('focus', focusHandler, false)\n      window.removeEventListener('beforeunload', beforeUnloadHandler, false);\n    }\n  }, [])\n  return (\n    <MuiThemeProvider theme={theme}>\n      <GraphEditor\n        style={{ width, height }}\n        {...controllerProps}\n      >\n        {\n          state.users.map((user) => userId !== user.id && (\n            // <Graph.View\n            //   width={10}\n            //   height={10}\n            //   fill={DefaultTheme.palette.primary.main}\n            //   x={user.position.x}\n            //   y={user.position.y}\n            // >\n            //   <Graph.Text text={R.takeLast(4, user.id)} />\n            // </Graph.View>\n            <MouseArrow \n              key={user.id}\n              user={user}\n              color={0xff3300}\n              position={user.position}\n              label={user.name}\n            />\n          ))\n        }\n      </GraphEditor>\n    </MuiThemeProvider>\n  );\n}","import Button from '@mui/material/Button';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport TextField from '@mui/material/TextField';\nimport React from 'react';\n\nexport type GetNameDialogProps = { \n  onSubmit: (name: string) => void;\n}\n\nexport const  GetNameDialog = (props: GetNameDialogProps) => {\n  const {\n    onSubmit,\n  } = props\n  const [name, setName] = React.useState('');\n  return (\n      <Dialog open={true}>\n        <DialogTitle>Set Your Name</DialogTitle>\n        <DialogContent>\n          {/* <DialogContentText>\n            To subscribe to this website, please enter your email address here. We\n            will send updates occasionally.\n          </DialogContentText> */}\n          <TextField\n            autoFocus\n            margin=\"dense\"\n            id=\"name\"\n            label=\"User name\"\n            fullWidth\n            variant=\"standard\"\n            value={name}\n            onChange={e => setName(e.target.value)}\n            onKeyPress={(e) => {\n              if (e.key === 'Enter') {\n                onSubmit(name)\n              }\n            }}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => onSubmit(name)}>Start</Button>\n        </DialogActions>\n      </Dialog>\n  );\n}","import React from 'react'\nimport { StyleSheet, Text, View, ActivityIndicator } from 'react-native';\nimport { MyGraphEditor } from './components/GraphEditor'\nimport { GetNameDialog } from './components/GetNameDialog'\nimport {  useLayout } from 'colay-ui'\nimport {  useImmer } from 'colay-ui/hooks/useImmer'\nimport { useAuth } from './api/firebase'\nimport  { Button } from '@mui/material'\nexport default function App() {\n  const {\n    width,\n    height,\n    onLayout,\n  } = useLayout()\n  const [state, updateState] = useImmer({\n    isLoading: true,\n    name: ''\n  })\n  const auth = useAuth()\n  console.log('Auth result', auth)\n  if (auth.isLoading) {\n    return (\n      <ActivityIndicator />\n    )\n  }\n  if (!auth.user) {\n    return (\n      <Button\n        onClick={() => auth.signin()}\n      >\n        Signin\n      </Button>\n    )\n  }\n  return (\n    <View\n      style={styles.container}\n      onLayout={onLayout}\n    >\n     {\n       state.isLoading\n       ? (\n          <GetNameDialog \n            onSubmit={(name) => {\n              updateState((draft)=> {\n                draft.isLoading = false\n                draft.name = name\n              })\n            }}\n          />\n       )\n       : (\n        <MyGraphEditor\n          {...{\n            width,\n            height,\n          }}\n          userName={state.name}\n        />\n       )\n     }\n    </View>\n  );\n}\n\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n});\n"],"sourceRoot":""}