{"version":3,"sources":["api/firebase.ts","components/MouseArrow.tsx","components/GraphEditor.tsx","components/GetNameDialog.tsx","App.tsx"],"names":["app","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","firestore","getAnalytics","getFirestore","PATHS","updateUser","variables","a","async","user","ref","doc","id","setDoc","err","console","log","deleteUser","deleteDoc","MouseArrow","position","label","color","React","useMemo","randomColor","Math","floor","random","toString","Color","rgbNumber","draw","useCallback","g","drawArrowHead","graphics","fill","to","x","y","unitVector","Graphics","Text","text","radius","bottomCenter","Vector","fromObject","unitDistanceVec","multiplyScalar","perpendicularUnitDistanceVec","clone","rotate","PI","leftControlPoint","add","rightControlPoint","topControlPoint","beginFill","drawPolygon","PIXI","endFill","PROJECT_ID","MyGraphEditor","props","width","height","userName","useImmer","users","state","updateState","userId","R","useController","nodes","edges","networkStatistics","local","onEvent","draft","type","payload","elementId","graphEditor","graphRef","cy","update","element","context","$id","getSelectedItemByElement","item","index","EVENT","UPDATE_DATA","value","getSelectedElementInfo","selectedItem","updateDoc","data","API","ADD_NODE","items","edgeItems","forEach","mode","EDITOR_MODE","ADD","DEFAULT","DELETE_NODE","itemIds","DELETE","ADD_EDGE","DELETE_EDGE","controllerProps","controller","graphEditorRef","removeUser","createUser","name","config","useSubscription","collection","onSnapshot","querySnapshot","docChanges","change","elementType","event","targetList","push","filter","edgeItem","source","target","useEffect","handleWindowChange","e","document","visibilityState","focusHandler","blurHandler","visibilityChangeHandler","beforeUnloadHandler","window","addEventListener","isTrackRef","current","interval","setInterval","debounced","getPointerPositionOnViewport","viewport","onMouseMove","clearInterval","removeEventListener","style","map","GetNameDialog","onSubmit","useState","setName","Dialog","open","DialogTitle","DialogContent","TextField","autoFocus","margin","fullWidth","variant","onChange","DialogActions","Button","onClick","App","useLayout","onLayout","isLoading","View","styles","container","StyleSheet","create","flex","backgroundColor","alignItems","justifyContent"],"mappings":"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","file":"static/js/app.4364bc15.chunk.js","sourcesContent":["// Import the functions you need from the SDKs you need\nimport { initializeApp } from \"firebase/app\";\nimport { getAnalytics } from \"firebase/analytics\";\nimport { \n  getFirestore, addDoc, updateDoc, doc,\n  onSnapshot, collection,  deleteDoc, setDoc,\n } from \"firebase/firestore\";\nimport { useSubscription,  } from 'colay-ui'\nimport { Position,  } from 'colay-ui/type'\nimport * as R from 'colay/ramda'\n// TODO: Add SDKs for Firebase products that you want to use\n// https://firebase.google.com/docs/web/setup#available-libraries\n\n// Your web app's Firebase configuration\n// For Firebase JS SDK v7.20.0 and later, measurementId is optional\nconst firebaseConfig = {\n  apiKey: \"AIzaSyB8I11ntIAhLCoz2iw2cWVZl6NoWQ44yR0\",\n  authDomain: \"perfectgraph-5c619.firebaseapp.com\",\n  databaseURL: \"https://perfectgraph-5c619.firebaseio.com\",\n  projectId: \"perfectgraph-5c619\",\n  storageBucket: \"perfectgraph-5c619.appspot.com\",\n  messagingSenderId: \"214633043236\",\n  appId: \"1:214633043236:web:fa42d761199303b786cfb1\",\n  measurementId: \"G-GYX9R6E88Y\"\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst analytics = getAnalytics(app);\nconst firestore = getFirestore(app);\n\nconst PATHS = {\n  projects: 'projects',\n  nodes: 'nodes',\n  edges: 'edges',\n  users: 'users',\n}\n\ntype Event = {\n  type: string;\n  elementType: 'nodes' | 'edges' | 'users';\n  data: any\n}\ntype SubscriptionConfig = {\n  projectId: string;\n  onEvent: (event: Event) => void;\n}\n\nexport const useProjectSubscription = (config: SubscriptionConfig) => { \n  const {\n     onEvent,\n     projectId,\n  } = config\n  // useSubscription(() => {\n  //   const ref = doc(firestore, `${PATHS.projects}/${projectId}`)\n  //     onSnapshot(ref,querySnapshot => {\n  //       const data = querySnapshot.data()\n\n  //     });\n  // })\n  // NODES\n  useSubscription(() => {\n    const ref = collection(firestore, `${PATHS.projects}/${projectId}/${PATHS.nodes}`)\n    onSnapshot(ref,querySnapshot => {\n      querySnapshot.docChanges().forEach(change => {\n        const data = change.doc.data()\n        onEvent({\n          elementType: 'nodes',\n          data,\n          type: change.type,\n        })\n      });\n    });\n  })\n  // EDGES\n  useSubscription(() => {\n    const ref = collection(firestore, `${PATHS.projects}/${projectId}/${PATHS.edges}`)\n    onSnapshot(ref,querySnapshot => {\n      querySnapshot.docChanges().forEach(change => {\n        const data = change.doc.data()\n        onEvent({\n          elementType: 'edges',\n          data,\n          type: change.type,\n        })\n      });\n    });\n  })\n  \n}\n\ntype CreateNodeVariables = {\n  projectId: string;\n  item: any\n}\nexport async function createNode(variables: CreateNodeVariables) {\n  const {\n    projectId,\n    item\n  } = variables\n  try {\n    const id = R.uuid()\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.nodes}/${item.id}`)\n    setDoc(\n      ref,\n      item,\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype DeleteNodeVariables = {\n  id: string;\n  projectId: string;\n}\nexport async function deleteNode(variables: DeleteNodeVariables) {\n  const { \n    id,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.nodes}/${id}`)\n    deleteDoc(ref)\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype UpdateNodeVariables = {\n  item: any;\n  projectId: string;\n}\nexport async function updateNode(variables: UpdateNodeVariables) {\n  const {\n    item,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.nodes}/${item.id}`)\n    updateDoc(\n      ref,\n      {\n        data: item.data\n      }\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\n\ntype CreateEdgeVariables = {\n  projectId: string;\n  item: any\n}\nexport async function createEdge(variables: CreateEdgeVariables) {\n  const {\n    projectId,\n    item\n  } = variables\n  try {\n    const id = R.uuid()\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.edges}/${item.id}`)\n    setDoc(\n      ref,\n      item\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype DeleteEdgeVariables = {\n  id: string;\n  projectId: string;\n}\nexport async function deleteEdge(variables: DeleteEdgeVariables) {\n  const { \n    id,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.edges}/${id}`)\n    deleteDoc(ref)\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\ntype UpdateEdgeVariables = {\n  item: any;\n  projectId: string;\n}\nexport async function updateEdge(variables: UpdateEdgeVariables) {\n  const {\n    item,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.edges}/${item.id}`)\n    updateDoc(\n      ref,\n      {\n        data: item.data\n      }\n    )\n  } catch (err) {\n    console.log('error creating node:', err)\n  }\n}\n\n\ntype UpdateUserVariables = {\n  user: any;\n  projectId: string;\n}\n\nexport async function updateUser(variables: UpdateUserVariables) {\n  const {\n    user,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.users}/${user.id}`)\n    setDoc(\n      ref,\n      user\n    )\n  } catch (err) {\n    console.log('error update user:', err)\n  }\n}\n\ntype DeleteUserVariables = {\n  id: string;\n  projectId: string;\n}\n\nexport async function deleteUser(variables: DeleteUserVariables) {\n  const {\n    id,\n    projectId,\n  } = variables\n  try {\n    const ref = doc(firestore,`${PATHS.projects}/${projectId}/${PATHS.users}/${id}`)\n    deleteDoc(\n      ref,\n    )\n  } catch (err) {\n    console.log('error deleting user:', err)\n  }\n}\n\nexport const useUserSubscription = (config: SubscriptionConfig) => { \n  const {\n     onEvent,\n     projectId,\n  } = config\n  useSubscription(() => {\n    const ref = collection(firestore, `${PATHS.projects}/${projectId}/${PATHS.users}`)\n    onSnapshot(ref,querySnapshot => {\n      querySnapshot.docChanges().forEach(change => {\n        const data = change.doc.data()\n        onEvent({\n          elementType: 'users',\n          data,\n          type: change.type,\n        })\n      });\n    });\n  })\n}\n\n// export function onCreateNode(callback: (node: any) => void) {\n//   try {\n//      return API.graphql({\n//       query: ON_CREATE_NODE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((nodeData) => {\n//       const nodeRaw = nodeData.value.data.onCreateNode\n//       callback(convertJSONStringFields(nodeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n// export function onUpdateNode(callback: (node: any) => void) {\n//   try {\n//      return API.graphql({\n//       query: ON_UPDATE_NODE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((nodeData) => {\n//       const nodeRaw = nodeData.value.data.onUpdateNode\n//       callback(convertJSONStringFields(nodeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n\n// export function onDeleteNode(callback: (id: string) => void) {\n//   try {\n//     return API.graphql({\n//       query: ON_DELETE_NODE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((nodeData) => {\n//       const nodeRaw = nodeData.value.data.onDeleteNode\n//       callback(nodeRaw.id)\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n\n// export function onCreateEdge(callback: (node: any) => void) {\n//   try {\n//      return API.graphql({\n//       query: ON_CREATE_EDGE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((edgeData) => {\n//       const edgeRaw = edgeData.value.data.onCreateEdge\n//       callback(convertJSONStringFields(edgeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n// export function onUpdateEdge(callback: (edge: any) => void) {\n//   try {\n//     return API.graphql({\n//       query: ON_UPDATE_EDGE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((edgeData) => {\n//       const edgeRaw = edgeData.value.data.onUpdateEdge\n//       callback(convertJSONStringFields(edgeRaw))\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }\n// export function onDeleteEdge(callback: (id: string) => void) {\n//   try {\n//     return API.graphql({\n//       query: ON_DELETE_EDGE,\n//       authMode: API_AUTH_MODE.API_KEY,\n//     }).subscribe((edgeData) => {\n//       const edgeRaw = edgeData.value.data.onDeleteEdge\n//       callback(edgeRaw.id)\n//     })\n//   } catch (err) {\n//     console.log('error creating node:', err)\n//   }\n// }","import React from 'react'\nimport { Graph } from 'perfect-graph'\nimport { Position } from 'colay/type'\nimport * as PIXI from 'pixi.js'\nimport  Vector from 'victor'\nimport  { Container } from '@inlet/react-pixi'\nimport Color from 'color'\n\nexport type MouseArrowProps = { \n  user: {id: string;};\n  color: number;\n  position: Position;\n  label: string;\n}\n\nexport const MouseArrow: React.FC<MouseArrowProps> = ({ user, position, label }) => {\n  const color = React.useMemo(() => {\n\n    var randomColor = `#${Math.floor(Math.random()*16777215).toString(16)}`;\n    console.log('a', randomColor, Color(randomColor).rgbNumber())\n    return Color(randomColor).rgbNumber()\n  },  [user.id])\n  const draw = React.useCallback(g => {\n    // g.clear()\n    // g.beginFill(color)\n    // g.lineStyle(4, color, 1)\n    // g.moveTo(50, 50)\n    // g.endFill()\n    drawArrowHead({\n      graphics: g,\n      fill: color,\n      to: {x: 0, y: 0},\n      unitVector: { x: -2, y: -2 },\n    })\n  }, [color])\n  \n  return (\n    <Container\n      x={position.x}\n      y={position.y}\n    >\n      <Graph.Graphics draw={draw}/>\n      <Graph.Text text={label} />\n    </Container>\n  )\n}\n\nconst drawArrowHead = ({\n  graphics,\n  to,\n  radius = 10,\n  unitVector,\n  fill,\n}: {\n  graphics: PIXI.Graphics;\n  unitVector: Position;\n  to: Position;\n  radius?: number;\n  fill: number;\n}) => {\n  const bottomCenter = Vector.fromObject(to)\n  const unitDistanceVec = Vector.fromObject(unitVector).multiplyScalar(radius)\n  const perpendicularUnitDistanceVec = unitDistanceVec.clone().rotate(-Math.PI / 2)\n  const leftControlPoint = perpendicularUnitDistanceVec\n    .clone()\n    .multiplyScalar(-1)\n    .add(bottomCenter)\n  const rightControlPoint = perpendicularUnitDistanceVec.clone().add(bottomCenter)\n  const topControlPoint = bottomCenter.clone().add(unitDistanceVec)\n  graphics.beginFill(fill)\n  graphics.drawPolygon(\n    new PIXI.Point(leftControlPoint.x, leftControlPoint.y),\n    new PIXI.Point(rightControlPoint.x, rightControlPoint.y),\n    new PIXI.Point(topControlPoint.x, topControlPoint.y),\n  )\n  // TODO: Dont remove the endFill\n  graphics.endFill()\n  // TODO: Check the performance effect of this later\n  // graphics.isSprite = true\n}\n","import React from 'react'\nimport { Graph, GraphEditor, } from \"perfect-graph\";\nimport { DefaultTheme } from \"perfect-graph/core/theme\";\nimport { getSelectedItemByElement, getSelectedElementInfo } from \"perfect-graph/utils\";\nimport { EVENT, EDITOR_MODE } from \"perfect-graph/constants\";\nimport { useController } from \"perfect-graph/plugins/controller\";\nimport { getPointerPositionOnViewport } from \"perfect-graph/utils\";\nimport * as API from \"../api/firebase\";\nimport * as R from \"colay/ramda\";\nimport { useImmer } from \"colay-ui/hooks/useImmer\";\nimport { MouseArrow } from './MouseArrow'\n\nconst PROJECT_ID = 'daa9975c-6bdc-4ab3-9a01-2d1dca1f2290'\n\ntype User = {\n  id: string;\n  name: string;\n  position: {\n    x: number;\n    y: number;\n  }\n}\n\nexport function MyGraphEditor(props: any) {\n  const {\n    width,\n    height,\n    userName,\n  } = props\n  const [state, updateState] = useImmer({\n    users: [] as User[],\n  })\n  const userId = React.useMemo(() => R.uuid(), [])\n  const [controllerProps, controller] = useController({\n    nodes: [],\n    edges: [],\n    networkStatistics: {\n      local: {\n\n      },\n    },\n    onEvent: ({\n      type,\n      payload,\n      elementId,\n      graphRef,\n      graphEditor,\n      update,\n      state,\n    }, draft) => {\n      const {\n        cy,\n        context: graphEditorContext\n      } = graphEditor\n      const element = cy.$id(elementId!)\n      const {\n        item: selectedItem,\n        index: selectedItemIndex,\n      } = (element && getSelectedItemByElement(element, draft)) ?? {}\n      switch (type) {\n        case EVENT.UPDATE_DATA: {\n          const {\n            value\n          } = payload\n          const {\n            type, selectedItem\n          } = getSelectedElementInfo(draft, graphEditor)\n          if (type === 'nodes') {\n            API.updateNode({\n              projectId: PROJECT_ID,\n              item: {\n                id: selectedItem.id,\n                data: value,\n              }\n            })\n          } else {\n            API.updateEdge({\n              projectId: PROJECT_ID,\n              item: {\n                id: selectedItem!.id,\n                data: value,\n              }\n            })\n          }\n          return false\n        }\n        case EVENT.ADD_NODE: {\n          const {\n            items,\n            edgeItems,\n          } = payload\n          // draft.nodes = draft.nodes.concat(items)\n          // draft.edges = draft.edges.concat(edgeItems ?? [])\n          // const { position } = payload\n          // draft.nodes.push({\n          //   id: `${draft.nodes.length + 1}`, // R.uuid(),\n          //   position,\n          //   data: [],\n          // })\n          items.forEach((item) => {\n            API.createNode({\n              projectId: PROJECT_ID,\n              item\n            })\n          })\n          if (draft.mode === EDITOR_MODE.ADD) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n        case EVENT.DELETE_NODE: {\n          const {\n            itemIds = [],\n          } = payload as {\n            itemIds: string[]\n          }\n          console.log('AA', itemIds)\n          // draft.nodes = draft.nodes.filter((nodeItem) => !itemIds.includes(nodeItem.id))\n          // draft.edges = draft.edges.filter(\n          //   (edgeItem) => !itemIds.includes(edgeItem.source)\n          //   && !itemIds.includes(edgeItem.target),\n          // )\n          itemIds.forEach((id) => {\n            API.deleteNode({\n              projectId: PROJECT_ID,\n              id\n            })\n          })\n          if (draft.mode === EDITOR_MODE.DELETE) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n        case EVENT.ADD_EDGE: {\n          const {\n            items,\n          } = payload\n          items.forEach((item) => {\n            API.createEdge({\n              projectId: PROJECT_ID,\n              item\n            })\n          })\n          if (draft.mode === EDITOR_MODE.ADD) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n        case EVENT.DELETE_EDGE: {\n          const {\n            itemIds = [],\n          } = payload as {\n            itemIds: string[]\n          }\n          itemIds.forEach((id) => {\n            API.deleteEdge({\n              projectId: PROJECT_ID,\n              id\n            })\n          })\n          if (draft.mode === EDITOR_MODE.DELETE) {\n            draft.mode = EDITOR_MODE.DEFAULT\n          }\n          return false\n        }\n      //   case EVENT.MODE_CHANGED: {\n      //     targetNodeRef.current = null\n      //     break\n      //   }\n        default:\n          break;\n      }\n    }\n  });\n  const graphEditorRef = controllerProps.ref\n  const removeUser = React.useCallback(() => {\n    API.deleteUser({\n      projectId: PROJECT_ID,\n      id: userId\n    })\n  }, [userId])\n  const  createUser = React.useCallback(() => {\n    API.updateUser({\n      projectId: PROJECT_ID,\n      user: {\n        id: userId,\n        name: userName,\n        position: {\n          x: 0,\n          y: 0\n        }\n      }\n    })\n  }, [userId])\n  API.useProjectSubscription({\n    projectId: PROJECT_ID,\n    onEvent: (event) => {\n       const {\n        type,\n        data,\n        elementType\n       } = event\n       controller.update((draft) => {\n        const targetList = draft[elementType]\n        switch (type) {\n          case 'added':\n            targetList.push(data)\n            break;\n          case 'modified':{\n            targetList.forEach(\n              (item, index) => {\n                if (item.id === data.id) {\n                  targetList[index] = data\n                }\n              }\n            )\n            // .filter((item) => item.id !== data.id)))\n            break;\n          }\n          case 'removed':\n            draft[elementType] = targetList.filter(\n              (item) => item.id !== data.id\n            )\n            if (elementType === 'nodes') {\n              draft.edges = draft.edges.filter(\n            (edgeItem) => data.id !==edgeItem.source\n              && data.id !== edgeItem.target,\n            )\n            }\n            break;\n        \n          default:\n            break;\n        }\n       })\n    }\n  })\n  API.useUserSubscription({\n    projectId: PROJECT_ID,\n    onEvent: (event) => {\n       const {\n        type,\n        data,\n        elementType\n       } = event\n       if (data.id === userId) {\n         return\n       }\n       updateState((draft) => {\n        switch (type) {\n          case 'added':\n            draft.users.push(data)\n            break;\n          case 'modified':{\n            draft.users.forEach(\n              (item, index) => {\n                if (item.id === data.id) {\n                  draft.users[index] = data\n                }\n              }\n            )\n            break;\n          }\n          case 'removed':\n            draft.users = draft.users.filter(\n              (item) => item.id !== data.id\n            )\n            break;\n        \n          default:\n            break;\n        }\n       })\n    }\n  })\n  React.useEffect(() => {\n    createUser()\n    const handleWindowChange = (type: string) => (e) => {\n      switch (type) {\n        case 'visibilitychange':\n          if (document.visibilityState === 'visible') {\n            createUser()\n          } else {\n            removeUser()\n          }          \n          break;\n        case 'focus':\n          createUser()\n          break;\n        case 'blur':\n          removeUser()\n          break;\n        case 'blur':\n          removeUser()\n          break;\n        case 'beforeunload':\n          removeUser()\n          break;\n      \n        default:\n          break;\n      }\n      console.log('Focus change', e)\n    }\n    const focusHandler = handleWindowChange('focus')\n    const blurHandler = handleWindowChange('blur')\n    const visibilityChangeHandler = handleWindowChange('visibilitychange')\n    const beforeUnloadHandler = handleWindowChange('beforeunload')\n    window.addEventListener('visibilitychange', visibilityChangeHandler, false)\n    window.addEventListener('blur', blurHandler, false)\n    window.addEventListener('focus', focusHandler, false)\n    window.addEventListener('beforeunload', beforeUnloadHandler, false);\n    let isTrackRef = {\n      current: true\n    }\n    const interval = setInterval(() => {\n      isTrackRef.current = true\n    }, 1000)\n    const debounced = R.debounce((event) => {\n        // if (isTrackRef.current) {\n          isTrackRef.current = false\n          const position = getPointerPositionOnViewport(\n            graphEditorRef.current.viewport,\n            event\n          )\n          API.updateUser({\n            projectId: PROJECT_ID,\n            user: {\n              id: userId,\n              name: userName,\n              position\n            }\n          })\n        // }\n      }, 1000)\n    const onMouseMove = (event) => {\n      debounced(event)\n    }\n    document.addEventListener('mousemove', onMouseMove)\n    return () => {\n      API.deleteUser({\n        projectId: PROJECT_ID,\n        id: userId\n      })\n      clearInterval(interval)\n      document.removeEventListener('mousemove', onMouseMove)\n      window.removeEventListener('visibilitychange', visibilityChangeHandler, false)\n      window.removeEventListener('blur', blurHandler, false)\n      window.removeEventListener('focus', focusHandler, false)\n      window.removeEventListener('beforeunload', beforeUnloadHandler, false);\n    }\n  }, [])\n  console.log(state.users)\n  return (\n    <GraphEditor\n      style={{ width, height }}\n      {...controllerProps}\n    >\n      {\n        state.users.map((user) => userId !== user.id && (\n          // <Graph.View\n          //   width={10}\n          //   height={10}\n          //   fill={DefaultTheme.palette.primary.main}\n          //   x={user.position.x}\n          //   y={user.position.y}\n          // >\n          //   <Graph.Text text={R.takeLast(4, user.id)} />\n          // </Graph.View>\n          <MouseArrow \n            key={user.id}\n            user={user}\n            color={0xff3300}\n            position={user.position}\n            label={user.name}\n          />\n        ))\n      }\n    </GraphEditor>\n  );\n}","import Button from '@mui/material/Button';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport TextField from '@mui/material/TextField';\nimport React from 'react';\n\nexport type GetNameDialogProps = { \n  onSubmit: (name: string) => void;\n}\n\nexport const  GetNameDialog = (props: GetNameDialogProps) => {\n  const {\n    onSubmit,\n  } = props\n  const [name, setName] = React.useState('');\n  return (\n      <Dialog open={true}>\n        <DialogTitle>Set Your Name</DialogTitle>\n        <DialogContent>\n          {/* <DialogContentText>\n            To subscribe to this website, please enter your email address here. We\n            will send updates occasionally.\n          </DialogContentText> */}\n          <TextField\n            autoFocus\n            margin=\"dense\"\n            id=\"name\"\n            label=\"User name\"\n            fullWidth\n            variant=\"standard\"\n            value={name}\n            onChange={e => setName(e.target.value)}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => onSubmit(name)}>Start</Button>\n        </DialogActions>\n      </Dialog>\n  );\n}","import React from 'react'\nimport { StatusBar } from 'expo-status-bar';\nimport { StyleSheet, Text, View } from 'react-native';\nimport { MyGraphEditor } from './components/GraphEditor'\nimport { GetNameDialog } from './components/GetNameDialog'\nimport {  useLayout } from 'colay-ui'\nimport {  useImmer } from 'colay-ui/hooks/useImmer'\n\nexport default function App() {\n  const {\n    width,\n    height,\n    onLayout,\n  } = useLayout()\n  const [state, updateState] = useImmer({\n    isLoading: true,\n    name: ''\n  })\n  return (\n    <View\n      style={styles.container}\n      onLayout={onLayout}\n    >\n     {\n       state.isLoading \n       ? (\n          <GetNameDialog \n            onSubmit={(name) => {\n              updateState((draft)=> {\n                draft.isLoading = false\n                draft.name = name\n              })\n            }}\n          />\n       )\n       : (\n        <MyGraphEditor\n          {...{\n            width,\n            height,\n          }}\n          userName={state.name}\n        />\n       )\n     }\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n});\n"],"sourceRoot":""}