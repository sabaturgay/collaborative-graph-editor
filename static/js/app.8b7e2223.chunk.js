(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{368:function(e,t,n){"use strict";n.d(t,"a",(function(){return ee}));var r=n(68),c=n.n(r),o=n(0),a=n.n(o),i=n(63),s=n(93),u=n(361),d=n(83),l=n.n(d),f=n(143),b=n(16),p=n(3),j=n(370),m=n(56),v=n.n(m),h=n(343),g=n(369),y=n(33),O=n(184),E=n(13),w=n(32),x=n(7),I=Object(h.a)({apiKey:"AIzaSyB8I11ntIAhLCoz2iw2cWVZl6NoWQ44yR0",authDomain:"perfectgraph-5c619.firebaseapp.com",databaseURL:"https://perfectgraph-5c619.firebaseio.com",projectId:"perfectgraph-5c619",storageBucket:"perfectgraph-5c619.appspot.com",messagingSenderId:"214633043236",appId:"1:214633043236:web:fa42d761199303b786cfb1",measurementId:"G-GYX9R6E88Y"}),L=(Object(g.a)(I),Object(y.d)(I)),D=Object(O.b)(I),P="projects",k="nodes",T="edges",S="users";function A(e){var t,n,r;return v.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t=e.user,n=e.projectId;try{r=Object(y.c)(L,P+"/"+n+"/"+S+"/"+t.id),Object(y.f)(r,t)}catch(o){console.log("error update user:",o)}case 2:case"end":return c.stop()}}),null,null,null,Promise)}function C(e){var t,n,r;return v.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t=e.id,n=e.projectId;try{r=Object(y.c)(L,P+"/"+n+"/"+S+"/"+t),Object(y.b)(r)}catch(o){console.log("error deleting user:",o)}case 2:case"end":return c.stop()}}),null,null,null,Promise)}var F=n(20),N=n(31),R=n.n(N),U=n(47),z=n(17),M=n.n(z),V=n(2),G=function(e){var t=e.user,n=e.position,r=e.label,c=a.a.useRef({targetPosition:n}),o=a.a.useRef(),i=a.a.useMemo((function(){var e="#"+Math.floor(16777215*Math.random()).toString(16);return console.log("a",e,M()(e).rgbNumber()),M()(e).rgbNumber()}),[t.id]),s=a.a.useCallback((function(e){_({graphics:e,fill:i,to:{x:0,y:0},unitVector:{x:-2,y:-2}})}),[i]);return a.a.useMemo((function(){c.current.targetPosition=n}),[n]),a.a.useEffect((function(){o.current.x=n.x,o.current.y=n.y;var e=function(){var e=o.current;if(e){var t=R.a.fromObject(c.current.targetPosition),n=R.a.fromObject(e),r=t.clone().subtract(n);if(r.length()<5)e.x=t.x,e.y=t.y;else{var a=r.clone().normalize(),i=n.clone().add(a.clone().multiplyScalar(5));e.x=i.x,e.y=i.y}}};return F.t.shared.add(e),function(){F.t.shared.remove(e)}}),[]),Object(V.jsxs)(U.Container,{ref:o,x:0,y:0,children:[Object(V.jsx)(f.a.Graphics,{draw:s}),Object(V.jsx)(f.a.Text,{text:r})]})},_=function(e){var t=e.graphics,n=e.to,r=e.radius,c=void 0===r?10:r,o=e.unitVector,a=e.fill,i=R.a.fromObject(n),s=R.a.fromObject(o).multiplyScalar(c),u=s.clone().rotate(-Math.PI/2),d=u.clone().multiplyScalar(-1).add(i),l=u.clone().add(i),f=i.clone().add(s);t.beginFill(a),t.drawPolygon(new F.l(d.x,d.y),new F.l(l.x,l.y),new F.l(f.x,f.y)),t.endFill()};function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B="daa9975c-6bdc-4ab3-9a01-2d1dca1f2290";function J(e){var t=e.width,n=e.height,r=e.userName,o=Object(w.a)({users:[]}),i=c()(o,2),s=i[0],u=i[1],d=a.a.useMemo((function(){return x.V()}),[]),l=a.a.useRef({user:null,mousePosition:{x:0,y:0},userInitialized:!1}),m=Object(j.a)({nodes:[],edges:[],networkStatistics:{local:{}},onEvent:function(e,t){var n,r=e.type,c=e.payload,o=e.elementId,a=(e.graphRef,e.graphEditor),i=(e.update,e.state,a.cy),s=(a.context,i.$id(o)),u=null!=(n=s&&Object(b.o)(s,t))?n:{};u.item,u.index;switch(r){case p.i.UPDATE_DATA:var d=c.value,l=Object(b.n)(t,a),f=l.type,j=l.selectedItem;return"nodes"===f?function(e){var t,n,r;v.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t=e.item,n=e.projectId;try{r=Object(y.c)(L,P+"/"+n+"/"+k+"/"+t.id),Object(y.g)(r,{data:t.data})}catch(o){console.log("error creating node:",o)}case 2:case"end":return c.stop()}}),null,null,null,Promise)}({projectId:B,item:{id:j.id,data:d}}):function(e){var t,n,r;v.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t=e.item,n=e.projectId;try{r=Object(y.c)(L,P+"/"+n+"/"+T+"/"+t.id),Object(y.g)(r,{data:t.data})}catch(o){console.log("error creating node:",o)}case 2:case"end":return c.stop()}}),null,null,null,Promise)}({projectId:B,item:{id:j.id,data:d}}),!1;case p.i.ADD_NODE:var m=c.items;c.edgeItems;return m.forEach((function(e){!function(e){var t,n,r;v.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t=e.projectId,n=e.item;try{x.V(),r=Object(y.c)(L,P+"/"+t+"/"+k+"/"+n.id),Object(y.f)(r,n)}catch(o){console.log("error creating node:",o)}case 2:case"end":return c.stop()}}),null,null,null,Promise)}({projectId:B,item:e})})),t.mode===p.f.ADD&&(t.mode=p.f.DEFAULT),!1;case p.i.DELETE_NODE:var h=c.itemIds;return(void 0===h?[]:h).forEach((function(e){!function(e){var t,n,r;v.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t=e.id,n=e.projectId;try{r=Object(y.c)(L,P+"/"+n+"/"+k+"/"+t),Object(y.b)(r)}catch(o){console.log("error creating node:",o)}case 2:case"end":return c.stop()}}),null,null,null,Promise)}({projectId:B,id:e})})),t.mode===p.f.DELETE&&(t.mode=p.f.DEFAULT),!1;case p.i.ADD_EDGE:return c.items.forEach((function(e){!function(e){var t,n,r;v.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t=e.projectId,n=e.item;try{x.V(),r=Object(y.c)(L,P+"/"+t+"/"+T+"/"+n.id),Object(y.f)(r,n)}catch(o){console.log("error creating node:",o)}case 2:case"end":return c.stop()}}),null,null,null,Promise)}({projectId:B,item:e})})),t.mode===p.f.ADD&&(t.mode=p.f.DEFAULT),!1;case p.i.DELETE_EDGE:var g=c.itemIds;return(void 0===g?[]:g).forEach((function(e){!function(e){var t,n,r;v.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:t=e.id,n=e.projectId;try{r=Object(y.c)(L,P+"/"+n+"/"+T+"/"+t),Object(y.b)(r)}catch(o){console.log("error creating node:",o)}case 2:case"end":return c.stop()}}),null,null,null,Promise)}({projectId:B,id:e})})),t.mode===p.f.DELETE&&(t.mode=p.f.DEFAULT),!1}}}),h=c()(m,2),g=h[0],O=h[1],I=g.ref,D=a.a.useCallback((function(){l.current.user=null,C({projectId:B,id:d})}),[d]),F=a.a.useCallback((function(){var e={id:d,name:r,position:l.current.mousePosition};return l.current.user=e,A({projectId:B,user:e}),e}),[d]);return function(e){var t=e.onEvent,n=e.projectId;Object(E.m)((function(){var e=Object(y.a)(L,P+"/"+n+"/"+k);Object(y.e)(e,(function(e){e.docChanges().forEach((function(e){var n=e.doc.data();t({elementType:"nodes",data:n,type:e.type})}))}))})),Object(E.m)((function(){var e=Object(y.a)(L,P+"/"+n+"/"+T);Object(y.e)(e,(function(e){e.docChanges().forEach((function(e){var n=e.doc.data();t({elementType:"edges",data:n,type:e.type})}))}))}))}({projectId:B,onEvent:function(e){var t=e.type,n=e.data,r=e.elementType;O.update((function(e){var c=e[r];switch(t){case"added":c.push(n);break;case"modified":c.forEach((function(e,t){e.id===n.id&&(c[t]=n)}));break;case"removed":e[r]=c.filter((function(e){return e.id!==n.id})),"nodes"===r&&(e.edges=e.edges.filter((function(e){return n.id!==e.source&&n.id!==e.target})))}}))}}),function(e){var t=e.onEvent,n=e.projectId;Object(E.m)((function(){var e=Object(y.a)(L,P+"/"+n+"/"+S);Object(y.e)(e,(function(e){e.docChanges().forEach((function(e){var n=e.doc.data();t({elementType:"users",data:n,type:e.type})}))}))}))}({projectId:B,onEvent:function(e){var t=e.type,n=e.data;e.elementType;n.id!==d&&u((function(e){switch(t){case"added":e.users.push(n);break;case"modified":e.users.forEach((function(t,r){t.id===n.id&&(e.users[r]=n)}));break;case"removed":e.users=e.users.filter((function(e){return e.id!==n.id}))}}))}}),a.a.useEffect((function(){var e=function(e){return function(t){switch(e){case"visibilitychange":"visible"===document.visibilityState?F():D();break;case"focus":F();break;case"blur":case"blur":case"beforeunload":D()}console.log("Focus change",t)}},t=e("focus"),n=e("blur"),c=e("visibilitychange"),o=e("beforeunload");window.addEventListener("visibilitychange",c,!1),window.addEventListener("blur",n,!1),window.addEventListener("focus",t,!1),window.addEventListener("beforeunload",o,!1);var a={current:!0},i=setInterval((function(){a.current=!0}),1e3),s=x.e((function(e){a.current=!1;var t=Object(b.m)(I.current.viewport,e);A({projectId:B,user:{id:d,name:r,position:t}})}),500),u=function(e){l.current.mousePosition=Object(b.m)(I.current.viewport,e),l.current.user||l.current.userInitialized||(l.current.userInitialized=!0,F()),s(e)};return document.addEventListener("mousemove",u),function(){C({projectId:B,id:d}),clearInterval(i),document.removeEventListener("mousemove",u),window.removeEventListener("visibilitychange",c,!1),window.removeEventListener("blur",n,!1),window.removeEventListener("focus",t,!1),window.removeEventListener("beforeunload",o,!1)}}),[]),Object(V.jsx)(f.b,Y(Y({style:{width:t,height:n}},g),{},{children:s.users.map((function(e){return d!==e.id&&Object(V.jsx)(G,{user:e,color:16724736,position:e.position,label:e.name},e.id)}))}))}var K=n(889),Q=n(893),X=n(895),Z=n(894),$=n(885),q=n(892),H=function(e){var t=e.onSubmit,n=a.a.useState(""),r=c()(n,2),o=r[0],i=r[1];return Object(V.jsxs)(Q.a,{open:!0,children:[Object(V.jsx)($.a,{children:"Set Your Name"}),Object(V.jsx)(Z.a,{children:Object(V.jsx)(q.a,{autoFocus:!0,margin:"dense",id:"name",label:"User name",fullWidth:!0,variant:"standard",value:o,onChange:function(e){return i(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&t(o)}})}),Object(V.jsx)(X.a,{children:Object(V.jsx)(K.a,{onClick:function(){return t(o)},children:"Start"})})]})};function ee(){var e=Object(E.k)(),t=e.width,n=e.height,r=e.onLayout,o=Object(w.a)({isLoading:!0,name:""}),i=c()(o,2),d=i[0],l=i[1],f=function(){var e=Object(w.a)({user:null,isLoading:!0}),t=c()(e,2),n=t[0],r=t[1];return a.a.useEffect((function(){!function(){var e,t;v.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,v.a.awrap(Object(O.c)(D,new O.a));case 3:e=n.sent,t=e.user,r((function(e){e.isLoading=!1,e.user=t})),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(0),alert("There is an error with your login! Refresh the page and try again!"),console.log("error",n.t0);case 12:case"end":return n.stop()}}),null,null,[[0,8]],Promise)}()}),[]),n}();return console.log("Auth result",f),Object(V.jsx)(s.a,{style:te.container,onLayout:r,children:f.isLoading?Object(V.jsx)(u.a,{}):d.isLoading?Object(V.jsx)(H,{onSubmit:function(e){l((function(t){t.isLoading=!1,t.name=e}))}}):Object(V.jsx)(J,{width:t,height:n,userName:d.name})})}var te=i.a.create({container:{flex:1,backgroundColor:"#fff",alignItems:"center",justifyContent:"center"}})},569:function(e,t,n){e.exports=n(812)}},[[569,1,2]]]);
//# sourceMappingURL=app.8b7e2223.chunk.js.map